<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Anúncio</title>

    <link rel="stylesheet" href="../../public/css/style.css">
    <link rel="stylesheet" href="../../view/user/cadastro.css">
    <link rel="stylesheet" href="criarAnuncio.css">
</head>

<body>
    <header>
        <nav>
            <a href="../home/homeInterna.html" class="btn-voltar">
                Voltar
            </a>
            <a href="../home/index.html">
                <img class="logo-image-nav" src="../../public/images/icon.png" alt="logo">
            </a>
        </nav>
    </header>

    <main>
        <div class="form-container">
            <h1 class="form-title">Cadastro de Anunciante</h1>
            <form class="cadastro-form">
                <label for="marca" class="obrigatorio">Marca</label>
                <input type="text" id="marca" name="marca" required>

                <label for="modelo" class="obrigatorio">Modelo</label>
                <input type="text" id="modelo" name="modelo" required>

                <label for="ano" class="obrigatorio">Ano de Fabricação</label>
                <input type="number" id="ano" name="ano" min="1900" max="2099" required>

                <label for="cor" class="obrigatorio">Cor</label>
                <input type="text" id="cor" name="cor" required>

                <label for="quilometragem" class="obrigatorio">Quilometragem (Km)</label>
                <input type="number" id="quilometragem" name="quilometragem" required>

                <label for="descricao">Descrição</label>
                <textarea id="descricao" name="descricao" rows="4" placeholder="Deixe sua descrição.."></textarea>

                <label for="valor" class="obrigatorio">Valor</label>
                <input type="number" id="valor" name="valor" step="0.01" required>

                <label for="estado" class="obrigatorio">Estado</label>
                <select id="estado" name="estado" required>
                    <option value="">Selecione</option>
                    <option value="AC">AC</option>
                    <option value="AL">AL</option>
                    <option value="AP">AP</option>
                    <option value="AM">AM</option>
                    <option value="BA">BA</option>
                    <option value="CE">CE</option>
                    <option value="DF">DF</option>
                    <option value="ES">ES</option>
                    <option value="GO">GO</option>
                    <option value="MA">MA</option>
                    <option value="MT">MT</option>
                    <option value="MS">MS</option>
                    <option value="MG">MG</option>
                    <option value="PA">PA</option>
                    <option value="PB">PB</option>
                    <option value="PR">PR</option>
                    <option value="PE">PE</option>
                    <option value="PI">PI</option>
                    <option value="RJ">RJ</option>
                    <option value="RN">RN</option>
                    <option value="RS">RS</option>
                    <option value="RO">RO</option>
                    <option value="RR">RR</option>
                    <option value="SC">SC</option>
                    <option value="SP">SP</option>
                    <option value="SE">SE</option>
                    <option value="TO">TO</option>
                </select>

                <label for="cidade" class="obrigatorio">Cidade</label>
                <input type="text" id="cidade" name="cidade" required>

                <label for="fotos" class="obrigatorio">Fotos do veículo (mínimo 3):</label>
                <input type="file" id="fotos" name="fotos[]" accept="image/*" multiple required>

                <button type="submit" class="form-button">Criar</button>
                <div id="status-mensagem" style="margin-top: 1rem; text-align: center;"></div>
            </form>
        </div>

    </main>

    <footer>
        <h3>Vitual Cars não é um site real</h3>
    </footer>

    <script>
        const form = document.querySelector('.cadastro-form');

        form.addEventListener('submit', async function (event) {
            event.preventDefault();

            const statusMsg = document.querySelector('#status-mensagem');
            const botaoSubmit = document.querySelector('.form-button');

            botaoSubmit.disabled = true;
            botaoSubmit.textContent = 'Enviando...';
            statusMsg.textContent = '';

            const formData = new FormData(form);

            try {

                const response = await fetch('/virtual_cars/controller/cadastra-anuncio.php', {
                    method: 'POST',
                    body: formData 
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    statusMsg.textContent = result.message;
                    statusMsg.style.color = 'green';
                    form.reset(); 

                    setTimeout(() => {
                        window.location.href = '../anuncio/listagem/listagemAnuncios.html';
                    }, 2000);

                } else {
                    statusMsg.textContent = result.message || 'Ocorreu um erro.';
                    statusMsg.style.color = 'red';
                }

            } catch (error) {
                console.error('Erro na requisição:', error);
                statusMsg.textContent = 'Falha de comunicação com o servidor. Tente novamente.';
                statusMsg.style.color = 'red';
            } finally {
                botaoSubmit.disabled = false;
                botaoSubmit.textContent = 'Criar';
            }
        });
    </script>
</body>

</html>